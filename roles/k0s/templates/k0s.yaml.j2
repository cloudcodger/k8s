---
# Generated by Ansible cloudcodger.k8s.k0s role
apiVersion: k0s.k0sproject.io/v1beta1
kind: ClusterConfig
spec:
  api:
    address: {{ ansible_default_ipv4['address'] }}
    sans:
{% for addr in groups[k0s_control_group] | intersect(ansible_play_batch) | map('extract', hostvars, ['ansible_facts', 'all_ipv4_addresses']) | flatten | sort %}
    - {{ addr }}
{% endfor %}
{% for addr in groups[k0s_control_group] | intersect(ansible_play_batch) | map('extract', hostvars, ['ansible_facts', 'all_ipv6_addresses']) | flatten | sort %}
{%   if addr is not ansible.builtin.regex('^fe80::') %}
    - {{ addr }}
{%   endif %}
{% endfor %}
{% if k0s_worker_profiles %}
  workerProfiles:
{%   for prof in k0s_worker_profiles %}
    - name: {{ prof['name'] }}
      values:
{%     for pkey, pval in prof['values'].items() %}
        {{ pkey }}: {{ pval }}
{%     endfor %}
{%   endfor %}
{% endif %}
  telemetry:
    enabled: true
